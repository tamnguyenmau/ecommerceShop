@model ECommerceShop.Models.Customer

@{
    ViewData["Title"] = "Thông tin khách hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<Order> DanhSachDonHang = ViewBag.DonHang;
    ECommerceShop.Req.ChangePassword changePassword = new ECommerceShop.Req.ChangePassword();
}

<div>
    
    <div class="account-page-area section-space-y-axis-100">
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <ul class="nav myaccount-tab-trigger" id="account-page-tab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="account-dashboard-tab" data-bs-toggle="tab" href="#account-dashboard" role="tab" aria-controls="account-dashboard" aria-selected="true">Thông tin tài khoản</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="account-orders-tab" data-bs-toggle="tab" href="#account-orders" role="tab" aria-controls="account-orders" aria-selected="false">Đơn hàng</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="account-details-tab" data-bs-toggle="tab" href="#account-details" role="tab" aria-controls="account-details" aria-selected="false">Đổi mật khẩu</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="account-logout-tab" href="/dangxuat" role="tab" aria-selected="false">Logout</a>
                        </li>
                    </ul>
                </div>
                <div class="col-lg-9">
                    <div class="tab-content myaccount-tab-content" id="account-page-tab-content">
                        <div class="tab-pane fade show active" id="account-dashboard" role="tabpanel" aria-labelledby="account-dashboard-tab">
                            <div class="myaccount-dashboard">
                                <p>
                                    Xin chào, <b>@Model.FullName</b>. Từ bảng điều khiển tài khoản của mình, bạn có thể xem các đơn đặt hàng gần đây, quản lý vận chuyển và chỉnh sửa mật khẩu cũng như chi tiết tài khoản của mình.
                                </p>
                                <div class="myaccount-form-inner">
                                    <div class="single-input">
                                        <label>Họ Tên</label>
                                        <p>@Model.FullName</p>
                                    </div>
                                    <div class="single-input">
                                        <label>Ngày sinh</label>
                                        <p>@Model.BirthDay</p>
                                    </div>
                                    <div class="single-input">
                                        <label>Địa chỉ</label>
                                        <p>@Model.Address</p>
                                    </div>
                                    <div class="single-input">
                                        <label>Email</label>
                                        <p>@Model.Email</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="account-orders" role="tabpanel" aria-labelledby="account-orders-tab">
                            <div class="myaccount-orders">
                                <h4 class="small-title">Đơn hàng của tôi</h4>
                                @if (DanhSachDonHang != null && DanhSachDonHang.Count() > 0)
                                {
                                    <div class="table-responsive">
                                        <table class="table table-bordered table-hover">
                                            <tbody>
                                                <tr>
                                                    <th>#</th>
                                                    <th>NGÀY TẠO</th>
                                                    <th>NGÀY GIAO</th>
                                                    <th>TÌNH TRẠNG</th>
                                                    <th>TỔNG TIỀN</th>
                                                    <th></th>
                                                </tr>
                                                @foreach (var item in DanhSachDonHang)
                                                {
                                                    <tr>
                                                        <td>@item.OrderId</td>
                                                        <td>@item.OrderDate</td>
                                                        <td>@item.ShipDate</td>
                                                        <td>@item.TransactStatus.Status</td>
                                                        <td>@item.TotalMoney.Value.ToString("#,##0") đ</td>
                                                        <td>
                                                            <a class="xemdonhang" href="#" data-madonhang="@item.OrderId">Xem Đơn Hàng</a>
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                        <br />
                                        <br />
                                        <br />
                                        <hr />
                                        <div id="records_table">

                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <p>Chưa có đơn hàng</p>
                                }
                            </div>
                        </div>
                        <div class="tab-pane fade" id="account-details" role="tabpanel" aria-labelledby="account-details-tab">
                            <div class="myaccount-details">
                                @await Html.PartialAsync("ChangePassword",changePassword)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script>
        $(document).ready(function () {
            $(".xemdonhang").click(function () {
                var madonhang = $(this).attr("data-madonhang");
                console.log(madonhang);
                $.ajax({
                    url: 'api/detailcart',
                    datatype: "json",
                    type: "POST",
                    data: { id: madonhang },
                    async: true,
                    success: function (response) {
                        $("#records_table").html("");
                        $("#records_table").html(response);
                    },
                    error: function (xhr) {
                        alert('error');
                    }
                });

            });
        });
    </script>
}


